{% extends 'master.html' %}
{% load static %}

{% block content %}
<!-- BOOTSTRAP -->
    <link rel="stylesheet" 
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">

<style>
    body {
        background: url("{% static 'images/bg.jpeg' %}") no-repeat center center/cover;
        background-attachment: fixed;
        font-family: "Poppins", sans-serif;
        overflow-x: hidden;
    }

    /* DARK OVERLAY */
    .overlay {
        background: rgba(0, 0, 0, 0.65);
        min-height: 100vh;
        padding: 20px;
    }

    /* ======= HEADER BAR ======= */
    .admin-header {
        background: rgba(0,0,0,0.7);
        padding: 18px 30px;
        border-radius: 12px;
        backdrop-filter: blur(10px);
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 25px;
        border: 1px solid rgba(255,255,255,0.1);
    }

    .admin-header h2 {
        margin: 0;
        color: #ff4444;
        font-weight: 700;
        letter-spacing: 1px;
    }

    .logout-btn {
        background: #ff4444;
        color: white !important;
        padding: 8px 20px;
        border-radius: 6px;
        font-weight: 600;
        text-decoration: none;
    }

    .logout-btn:hover {
        background: #cc0000;
    }

    /* ======= SUMMARY CARDS ======= */
    .summary-card {
        padding: 22px;
        border-radius: 16px;
        color: white;
        backdrop-filter: blur(8px);
        background: rgba(255,255,255,0.08);
        border: 1px solid rgba(255,255,255,0.2);
        box-shadow: 0 6px 12px rgba(0,0,0,0.25);
        transition: 0.3s ease;
    }

    .summary-card:hover {
        transform: translateY(-4px);
    }

    .summary-content h4 {
        margin: 0;
        font-size: 14px;
        opacity: 0.8;
    }

    .summary-content h2 {
        font-size: 32px;
        margin-top: 5px;
        font-weight: 700;
    }

    .summary-icon {
        font-size: 28px;
        opacity: 0.9;
    }

    /* ======= WHITE BOX (Glass Boxes) ======= */
    .white-box {
        background: rgba(255,255,255,0.08);
        padding: 25px;
        border-radius: 14px;
        margin-top: 30px;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255,255,255,0.18);
        box-shadow: 0 4px 12px rgba(0,0,0,0.25);
    }

    .white-box h5 {
        font-weight: 700;
        font-size: 18px;
        color: #ff4444;
        margin-bottom: 16px;
    }

    /* ======= TABLE ======= */
    table {
        background: rgba(0,0,0,0.3);
        border-radius: 10px;
        overflow: hidden;
        color: white;
    }

    table thead th {
        background: rgba(255,255,255,0.15);
        padding: 12px;
        color: #f3f3f3;
        font-size: 14px;
    }

    table tbody td {
        background: rgba(0,0,0,0.25);
        border-bottom: 1px solid rgba(255,255,255,0.1);
        padding: 10px;
    }

    table tbody tr:hover td {
        background: rgba(255,255,255,0.08);
    }


/* ===== BADGES ===== */
.badge-success {
    background: #ff6b6b;  /* Matches dashboard red/pink tone */
    padding: 6px 12px;
    border-radius: 8px;
    font-weight: 600;
    color: white;
}

.badge-danger {
    background: rgba(1, 0, 0, 0.854);  /* Semi-transparent for "Not Assigned" */
    padding: 6px 12px;
    border-radius: 8px;
    font-weight: 600;
    color: #f3f3f3;
}

/* ===== BUTTONS ===== */
.btn-assign {
    background: #ff6b6b;  /* Primary pink/red tone */
    color: white !important;
    padding: 6px 14px;
    border-radius: 8px;
    font-weight: 600;
    border: none;
    transition: 0.3s;
}

.btn-assign:hover {
    background: #e63946;  /* Darker shade on hover */
}

.btn-reassign {
    background: #f4a261;  /* Soft orange tone matching dashboard accent */
    color: white !important;
    padding: 6px 14px;
    border-radius: 8px;
    font-weight: 600;
    border: none;
    transition: 0.3s;
}

.btn-reassign:hover {
    background: #e07b3c;  /* Darker orange on hover */
}


</style>

<div class="overlay">

    <div class="admin-header">
        <h2>ADMIN DASHBOARD</h2>

        <a href="{% url 'logout' %}" class="logout-btn">Logout</a>
    </div>


<div class="container dashboard-container">

    
<!-- 
    <h2 class="text-center">Admin Dashboard</h2> -->

    <!-- SUMMARY CARDS -->
    <div class="row g-3">

        <div class="col-md-3">
            <div class="summary-card bg-blue">
                <div class="summary-content">
                    <h4>Total Rooms</h4>
                    <h2>{{ total_rooms }}</h2>
                </div>
                <div class="summary-icon">üè†</div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="summary-card bg-green">
                <div class="summary-content">
                    <h4>Occupied Rooms</h4>
                    <h2>{{ occupied_rooms }}</h2>
                </div>
                <div class="summary-icon">üõèÔ∏è</div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="summary-card bg-red">
                <div class="summary-content">
                    <h4>Vacant Rooms</h4>
                    <h2>{{ vacant_rooms }}</h2>
                </div>
                <div class="summary-icon">üë§</div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="summary-card bg-orange">
                <div class="summary-content">
                    <h4>Total Students</h4>
                    <h2>{{ total_students }}</h2>
                </div>
                <div class="summary-icon">üéì</div>
            </div>
        </div>

    </div>

    <!-- ROOM MANAGEMENT SECTION -->
<div class="white-box">
    <h5>Room Management</h5>

    <a href="{% url 'room_list' %}" 
       style="background:#4287f5; color:white; padding:10px 20px; 
              border-radius:8px; font-weight:600; text-decoration:none;">
        View / Manage Rooms
    </a>
</div>


    <!-- RECENT ROOM ALLOCATIONS -->
    <div class="white-box">
        <h5>Recent Room Allocations</h5>
        <table class="table">
            <thead>
                <tr>
                    <th>Student ID</th>
                    <th>Student</th>
                    <th>Room</th>
                    <th>Date</th>
                </tr>
            </thead>
            <tbody>
                {% for a in recent_allocations %}
                <tr>
                    <td>{{ a.student.roll_no }}</td>
                    <td>{{ a.student.first_name }}</td>
                    <td>{{ a.room.room_number }}</td>
                    <td>{{ a.created_at|date:"d/m/Y" }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- AVAILABLE ROOMS -->
    <div class="white-box">
        <h5>Available Rooms</h5>
        <table class="table">
    <thead>
        <tr>
            <th>Room No</th>
            <th>Type</th>
            <th>Capacity</th>
            <th>Occupied</th>
            <th>Available</th>
        </tr>
    </thead>

    <tbody>
        {% for r in available_rooms %}
        <tr>
            <td>{{ r.room_number }}</td>
            <td>{{ r.room_type }}</td>
            <td>{{ r.capacity }}</td>
            <td>{{ r.current_occupancy }}</td>
            <td>{{ r.remaining_beds }}</td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="5" class="text-center text-muted">
                No available rooms
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

    </div>

    <!-- STUDENT STATUS -->
    <div class="white-box">
        <h5>Student Allocation Status</h5>
        <table class="table">
            <thead>
                <tr>
                    <th>Student</th>
                    <th>Department</th>
                    <th>Room Status</th>
                    <th>Action</th>
                </tr>
            </thead>

            <tbody>
                {% for s in students %}
                <tr>
                    <td>{{ s.first_name }}</td>
                    <td>{{ s.department }}</td>
                    <td>
                        {% if s.room %}
                        <span class="badge-success">Assigned ({{ s.room.room_number }})</span>
                        {% else %}
                        <span class="badge-danger">Not Assigned</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if s.room %}
                        <a href="{% url 'reassign_room' s.id %}" class="btn-reassign">Reassign</a>
                        {% else %}
                        <a href="{% url 'assign_room_to_student' s.id %}" class="btn-assign">Assign</a>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>

        </table>
    </div>

</div>

{% endblock %}
