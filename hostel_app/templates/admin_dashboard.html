{% extends 'master.html' %}
{% load static %}

{% block content %}
<!-- BOOTSTRAP -->
    <link rel="stylesheet" 
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
<style>
    body {
        background: #f5f6fa;
        font-family: "Poppins", sans-serif;
    }

    h2 {
        font-weight: 700;
        color: #111;
        margin-bottom: 25px;
    }

    /* ================== SUMMARY CARDS ================== */
    .summary-card {
        padding: 22px;
        border-radius: 16px;
        color: white;
        box-shadow: 0 6px 12px rgba(0,0,0,0.12);
        display: flex;
        justify-content: space-between;
        align-items: center;
        transition: 0.3s ease;
    }

    .summary-card:hover {
        transform: translateY(-4px);
    }

    .summary-content h4 {
        margin: 0;
        font-size: 16px;
        font-weight: 600;
    }

    .summary-content h2 {
        font-size: 36px;
        margin-top: 5px;
        font-weight: 700;
    }

    .summary-icon {
        font-size: 28px;
        opacity: 0.9;
    }

    .bg-blue { background: #4287f5; }
    .bg-green { background: #2ecc71; }
    .bg-red { background: #e74c3c; }
    .bg-orange { background: #f39c12; }

    /* ================== WHITE BOX SECTIONS ================== */
    .white-box {
        background: white;
        padding: 25px;
        border-radius: 14px;
        margin-top: 30px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }

    .white-box h5 {
        font-weight: 700;
        font-size: 18px;
        color: #222;
        margin-bottom: 16px;
    }

    /* ================== TABLE ================== */
    table {
        background: white;
        border-collapse: collapse;
        width: 100%;
        border-radius: 10px;
        overflow: hidden;
    }

    table thead th {
        font-size: 14px;
        font-weight: 600;
        background: #f3f3f3;
        padding: 13px;
        color: #555;
    }

    table tbody td {
        padding: 12px;
        font-size: 14px;
        color: #333;
        border-bottom: 1px solid #eee;
    }

    table tbody tr:hover {
        background: #f2f6ff;
    }

    /* ================== BUTTONS ================== */
    .btn-assign {
        background: #4287f5;
        color: white !important;
        padding: 6px 14px;
        border-radius: 6px;
        font-weight: 600;
        font-size: 13px;
        border: none;
    }

    .btn-reassign {
        background: #f39c12;
        color: white !important;
        padding: 6px 14px;
        border-radius: 6px;
        font-weight: 600;
        font-size: 13px;
        border: none;
    }

    /* ================== BADGES ================== */
    .badge-success {
        background: #2ecc71;
        padding: 6px 12px;
        border-radius: 8px;
        font-weight: 600;
        color: white;
    }

    .badge-danger {
        background: #e74c3c;
        padding: 6px 12px;
        border-radius: 8px;
        font-weight: 600;
        color: white;
    }

</style>

<div class="container dashboard-container">

    <h2 class="text-center">Admin Dashboard</h2>

    <!-- SUMMARY CARDS -->
    <div class="row g-3">

        <div class="col-md-3">
            <div class="summary-card bg-blue">
                <div class="summary-content">
                    <h4>Total Rooms</h4>
                    <h2>{{ total_rooms }}</h2>
                </div>
                <div class="summary-icon">üè†</div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="summary-card bg-green">
                <div class="summary-content">
                    <h4>Occupied Rooms</h4>
                    <h2>{{ occupied_rooms }}</h2>
                </div>
                <div class="summary-icon">üõèÔ∏è</div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="summary-card bg-red">
                <div class="summary-content">
                    <h4>Vacant Rooms</h4>
                    <h2>{{ vacant_rooms }}</h2>
                </div>
                <div class="summary-icon">üë§</div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="summary-card bg-orange">
                <div class="summary-content">
                    <h4>Total Students</h4>
                    <h2>{{ total_students }}</h2>
                </div>
                <div class="summary-icon">üéì</div>
            </div>
        </div>

    </div>

    <!-- ROOM MANAGEMENT SECTION -->
<div class="white-box">
    <h5>Room Management</h5>

    <a href="{% url 'room_list' %}" 
       style="background:#4287f5; color:white; padding:10px 20px; 
              border-radius:8px; font-weight:600; text-decoration:none;">
        View / Manage Rooms
    </a>
</div>


    <!-- RECENT ROOM ALLOCATIONS -->
    <div class="white-box">
        <h5>Recent Room Allocations</h5>
        <table class="table">
            <thead>
                <tr>
                    <th>Student</th>
                    <th>Room</th>
                    <th>Date</th>
                </tr>
            </thead>
            <tbody>
                {% for a in recent_allocations %}
                <tr>
                    <td>{{ a.student.name }}</td>
                    <td>{{ a.room.room_number }}</td>
                    <td>{{ a.created_at|date:"d/m/Y" }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- AVAILABLE ROOMS -->
    <div class="white-box">
        <h5>Available Rooms</h5>
        <table class="table">
            <thead>
                <tr>
                    <th>Room No</th>
                    <th>Type</th>
                    <th>Capacity</th>
                    <th>Occupied</th>
                    <th>Available</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                {% for r in available_rooms %}
                <tr>
                    <td>{{ r.room_number }}</td>
                    <td>{{ r.room_type }}</td>
                    <td>{{ r.capacity }}</td>
                    <td>{{ r.current_occupancy }}</td>
                    <td>{{ r.remaining_beds }}</td>
                    <td>
                        <a href="{% url 'allocate_room' r.id %}" class="btn-assign">Allocate</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- STUDENT STATUS -->
    <div class="white-box">
        <h5>Student Allocation Status</h5>
        <table class="table">
            <thead>
                <tr>
                    <th>Student</th>
                    <th>Department</th>
                    <th>Room Status</th>
                    <th>Action</th>
                </tr>
            </thead>

            <tbody>
                {% for s in students %}
                <tr>
                    <td>{{ s.first_name }}</td>
                    <td>{{ s.department }}</td>
                    <td>
                        {% if s.room %}
                        <span class="badge-success">Assigned ({{ s.room.room_number }})</span>
                        {% else %}
                        <span class="badge-danger">Not Assigned</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if s.room %}
                        <a href="{% url 'reassign_room' s.id %}" class="btn-reassign">Reassign</a>
                        {% else %}
                        <a href="{% url 'assign_room_to_student' s.id %}" class="btn-assign">Assign</a>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>

        </table>
    </div>

</div>

{% endblock %}
